<!-- templates/form.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - Finstreet Global Markets</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        .form-input:focus {
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }

        .required:after {
            content: " *";
            color: #EF4444;
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex-shrink-0 flex items-center">
                    <span class="text-xl font-bold text-indigo-600">Finstreet</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- <div class="min-h-screen py-8" x-data="{ step: 1, totalSteps: 5 }" x-ref="formComponent"> -->
    <div class="min-h-screen py-8" x-data="formHandler()" x-ref="formComponent" @navigate-to-step.window="handleNavigateToStep($event)">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Form Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900">Admission to Trade Application</h1>
                <p class="mt-2 text-sm text-gray-600">Exempt Offers</p>
            </div>

            <!-- Progress Bar -->
            <div class="mb-8">
                <div class="relative">
                    <div class="overflow-hidden h-2 mb-4 text-xs flex rounded bg-gray-200">
                        <div class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-500"
                            :style="'width: ' + ((step / totalSteps) * 100) + '%'"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-600">
                        <div class="w-1/5 text-center" :class="{ 'text-indigo-600 font-semibold': step >= 1 }">
                            Issuer Information
                        </div>
                        <div class="w-1/5 text-center" :class="{ 'text-indigo-600 font-semibold': step >= 2 }">
                            Share Capital
                        </div>
                        <div class="w-1/5 text-center" :class="{ 'text-indigo-600 font-semibold': step >= 3 }">
                            Securities Details
                        </div>
                        <div class="w-1/5 text-center" :class="{ 'text-indigo-600 font-semibold': step >= 4 }">
                            Shareholding Structure
                        </div>
                        <div class="w-1/5 text-center" :class="{ 'text-indigo-600 font-semibold': step >= 5 }">
                            Documents & Declaration
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Form -->
            <div class="bg-white shadow-md rounded-lg">
                <div class="p-6">
                    <form id="admissionForm" method="POST" action="/submit" novalidate>
                        <!-- Step 1: Issuer Information -->
                        <div x-show="step === 1" data-step="1">
                            <div class="mb-8">
                                <h2 class="text-xl font-semibold text-gray-900">A. Issuer Information</h2>
                                <p class="mt-1 text-sm text-gray-500">Please provide the required information about the
                                    issuer.</p>
                            </div>

                            <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                                <!-- Company Details -->
                                <div class="sm:col-span-1">
                                    <label for="company_name" class="block text-sm font-medium text-gray-700 required">
                                        Company Legal Name
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="issuer_info.company_name" id="company_name"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="trade_name" class="block text-sm font-medium text-gray-700">
                                        Trade Name (if different)
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="issuer_info.trade_name" id="trade_name"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                    </div>
                                </div>

                                <div class="sm:col-span-2">
                                    <label for="constitution" class="block text-sm font-medium text-gray-700 required">
                                        Constitution
                                    </label>
                                    <div class="mt-1">
                                        <select id="constitution" name="issuer_info.constitution"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                            <option value="">Select Constitution Type</option>
                                            <option value="LLC">LLC</option>
                                            <option value="Public">Public</option>
                                            <option value="PJSC">PJSC</option>
                                            <option value="Other">Other</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Incorporation Details -->
                                <div class="sm:col-span-1">
                                    <label for="incorporation_country"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Country of Incorporation
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="issuer_info.incorporation_details.country"
                                            id="incorporation_country"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="incorporation_date"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Date of Incorporation
                                    </label>
                                    <div class="mt-1">
                                        <input type="date" name="issuer_info.incorporation_details.date"
                                            id="incorporation_date"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="registration_number"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Company Registration Number
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="issuer_info.incorporation_details.reg_number"
                                            id="registration_number"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="lei" class="block text-sm font-medium text-gray-700 required">
                                        Legal Entity Identifier (LEI)
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="issuer_info.incorporation_details.lei" id="lei"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            pattern="^[0-9A-Z]{20}$" required>
                                        <p class="mt-1 text-sm text-gray-500">20 character alphanumeric code</p>
                                    </div>
                                </div>

                                <!-- Address Details -->
                                <div class="sm:col-span-2">
                                    <label for="registered_address"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Registered Office Address
                                    </label>
                                    <div class="mt-1">
                                        <textarea name="issuer_info.address.registered" id="registered_address" rows="3"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required></textarea>
                                    </div>
                                </div>

                                <div class="sm:col-span-2">
                                    <label for="corporate_address"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Corporate/Principal Office Address
                                    </label>
                                    <div class="mt-1">
                                        <textarea name="issuer_info.address.corporate" id="corporate_address" rows="3"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required></textarea>
                                    </div>
                                </div>

                                <div class="sm:col-span-2">
                                    <label for="website" class="block text-sm font-medium text-gray-700">
                                        Company Website
                                    </label>
                                    <div class="mt-1">
                                        <input type="url" name="issuer_info.address.website" id="website"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            placeholder="https://example.com">
                                    </div>
                                </div>

                                <!-- Operations -->
                                <div class="sm:col-span-2">
                                    <label for="operations" class="block text-sm font-medium text-gray-700 required">
                                        Operations in countries
                                    </label>
                                    <div class="mt-1">
                                        <textarea name="issuer_info.operations" id="operations" rows="3"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required placeholder="List countries where the company operates"></textarea>
                                    </div>
                                </div>

                                <!-- Industry & Description -->
                                <div class="sm:col-span-2">
                                    <label for="industry_sector"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Industry Sector
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="issuer_info.industry_sector" id="industry_sector"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-2">
                                    <label for="group_description"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Group Description
                                    </label>
                                    <div class="mt-1">
                                        <textarea name="issuer_info.group_description" id="group_description" rows="4"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required
                                            placeholder="Describe the group structure and activities"></textarea>
                                    </div>
                                </div>

                                <!-- Contact Person Section -->
                                <div class="sm:col-span-2 mt-8">
                                    <h3 class="text-lg font-medium text-gray-900 mb-4">Contact Person</h3>
                                    <div
                                        class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2 bg-gray-50 p-6 rounded-lg">
                                        <div class="sm:col-span-1">
                                            <label for="contact_name"
                                                class="block text-sm font-medium text-gray-700 required">
                                                Contact Person Name
                                            </label>
                                            <div class="mt-1">
                                                <input type="text" name="issuer_info.contact_person.name"
                                                    id="contact_name"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    required>
                                            </div>
                                        </div>

                                        <div class="sm:col-span-1">
                                            <label for="contact_position"
                                                class="block text-sm font-medium text-gray-700 required">
                                                Position
                                            </label>
                                            <div class="mt-1">
                                                <input type="text" name="issuer_info.contact_person.position"
                                                    id="contact_position"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    required>
                                            </div>
                                        </div>

                                        <div class="sm:col-span-1">
                                            <label for="contact_phone"
                                                class="block text-sm font-medium text-gray-700 required">
                                                Phone Number
                                            </label>
                                            <div class="mt-1">
                                                <input type="tel" name="issuer_info.contact_person.phone"
                                                    id="contact_phone"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    pattern="[0-9+\s-()]+" placeholder="+1 (234) 567-8900" required>
                                            </div>
                                        </div>

                                        <div class="sm:col-span-1">
                                            <label for="contact_email"
                                                class="block text-sm font-medium text-gray-700 required">
                                                Email Address
                                            </label>
                                            <div class="mt-1">
                                                <input type="email" name="issuer_info.contact_person.email"
                                                    id="contact_email"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    placeholder="contact@company.com" required>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Navigation Buttons -->
                        <div class="mt-8 border-t border-gray-200 pt-8">
                            <div class="flex justify-between">
                                <button type="button" x-show="step > 1" @click="step--"
                                    class="inline-flex justify-center py-3 px-6 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Previous
                                </button>
                                <button type="button" x-show="step < totalSteps" @click="step++"
                                    class="inline-flex justify-center py-3 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Next
                                </button>
                                <button type="submit" x-show="step === totalSteps"
                                    class="inline-flex justify-center py-3 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                                    Submit Application
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Share Capital -->
                        <div x-show="step === 2" data-step="2">
                            <div class="mb-8">
                                <h2 class="text-xl font-semibold text-gray-900">B. Share Capital</h2>
                                <p class="mt-1 text-sm text-gray-500">Enter details about the company's share capital
                                    structure.</p>
                            </div>

                            <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                                <!-- Authorized Share Capital -->
                                <div class="sm:col-span-1">
                                    <label for="auth_share_amount"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Authorized Share Capital Amount (USD)
                                    </label>
                                    <div class="mt-1">
                                        <input type="number" name="securities_info.share_capital.authorized.amount"
                                            id="auth_share_amount"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="auth_share_number"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Number of Authorized Shares
                                    </label>
                                    <div class="mt-1">
                                        <input type="number" name="securities_info.share_capital.authorized.num_shares"
                                            id="auth_share_number"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <!-- Paid-up Share Capital -->
                                <div class="sm:col-span-1">
                                    <label for="paid_share_amount"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Paid-up Share Capital Amount (USD)
                                    </label>
                                    <div class="mt-1">
                                        <input type="number" name="securities_info.share_capital.paid_up.amount"
                                            id="paid_share_amount"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="paid_share_number"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Number of Paid-up Shares
                                    </label>
                                    <div class="mt-1">
                                        <input type="number" name="securities_info.share_capital.paid_up.num_shares"
                                            id="paid_share_number"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <!-- Exchange Listings -->
                                <div class="sm:col-span-1">
                                    <label for="primary_exchange" class="block text-sm font-medium text-gray-700">
                                        Primary Exchange (if listed)
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="securities_info.exchanges.primary"
                                            id="primary_exchange"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="secondary_exchange" class="block text-sm font-medium text-gray-700">
                                        Secondary Exchange (if any)
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="securities_info.exchanges.secondary"
                                            id="secondary_exchange"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Securities Details -->
                        <div x-show="step === 3" data-step="3">
                            <div class="mb-8">
                                <h2 class="text-xl font-semibold text-gray-900">C. Securities Details</h2>
                                <p class="mt-1 text-sm text-gray-500">Provide information about the securities to be
                                    offered.</p>
                            </div>

                            <div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                                <div class="sm:col-span-2">
                                    <label for="security_type" class="block text-sm font-medium text-gray-700 required">
                                        Type of Security
                                    </label>
                                    <div class="mt-1">
                                        <select id="security_type" name="securities_info.security.type"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                            <option value="">Select Security Type</option>
                                            <option value="equity">Equity Shares</option>
                                            <option value="preference">Preference Shares</option>
                                            <option value="bonds">Bonds</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="security_isin" class="block text-sm font-medium text-gray-700 required">
                                        ISIN
                                    </label>
                                    <div class="mt-1">
                                        <input type="text" name="securities_info.security.isin" id="security_isin"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="expected_size" class="block text-sm font-medium text-gray-700 required">
                                        Expected Size of Offer (USD in million)
                                    </label>
                                    <div class="mt-1">
                                        <input type="number" name="securities_info.security.expected_size"
                                            id="expected_size" step="0.01"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="market_cap" class="block text-sm font-medium text-gray-700 required">
                                        Expected Market Capitalization (USD in million)
                                    </label>
                                    <div class="mt-1">
                                        <input type="number" name="securities_info.security.market_cap" id="market_cap"
                                            step="0.01"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-1">
                                    <label for="num_securities"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Number of Securities Offered
                                    </label>
                                    <div class="mt-1">
                                        <input type="number" name="securities_info.security.num_securities"
                                            id="num_securities"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                    </div>
                                </div>

                                <div class="sm:col-span-2">
                                    <label for="pricing_method"
                                        class="block text-sm font-medium text-gray-700 required">
                                        Method of Pricing
                                    </label>
                                    <div class="mt-1">
                                        <select id="pricing_method" name="securities_info.security.pricing_method"
                                            class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                            required>
                                            <option value="">Select Pricing Method</option>
                                            <option value="fixed">Fixed Price</option>
                                            <option value="book_building">Book Building</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 4: Shareholding Structure -->
                        <div x-show="step === 4" data-step="4">
                            <div class="mb-8">
                                <h2 class="text-xl font-semibold text-gray-900">D. Shareholding Structure</h2>
                                <p class="mt-1 text-sm text-gray-500">List major shareholders and their holdings.</p>
                            </div>

                            <div class="grid grid-cols-1 gap-y-6 gap-x-4">
                                <div class="col-span-1" x-data="{ shareholders: [] }">
                                    <template x-for="(shareholder, index) in shareholders" :key="index">
                                        <div
                                            class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-4 mb-4 p-4 border border-gray-200 rounded-md">
                                            <div class="sm:col-span-1">
                                                <label class="block text-sm font-medium text-gray-700">
                                                    Shareholder Name
                                                </label>
                                                <input type="text" x-model="shareholder.name"
                                                    class="mt-1 form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                            <div class="sm:col-span-1">
                                                <label class="block text-sm font-medium text-gray-700">
                                                    Category
                                                </label>
                                                <select x-model="shareholder.category"
                                                    class="mt-1 form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                    <option value="promoter">Promoter</option>
                                                    <option value="connected">Connected Person</option>
                                                    <option value="director">Director</option>
                                                    <option value="key_official">Key Official</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                            <div class="sm:col-span-1">
                                                <label class="block text-sm font-medium text-gray-700">
                                                    Number of Shares
                                                </label>
                                                <input type="number" x-model="shareholder.shares"
                                                    class="mt-1 form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                            <div class="sm:col-span-1">
                                                <label class="block text-sm font-medium text-gray-700">
                                                    Percentage Holding
                                                </label>
                                                <input type="number" x-model="shareholder.percentage" step="0.01"
                                                    class="mt-1 form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                        </div>
                                    </template>

                                    <button type="button" @click="shareholders.push({})"
                                        class="mt-4 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        <svg class="-ml-1 mr-2 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg"
                                            viewBox="0 0 20 20" fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z"
                                                clip-rule="evenodd" />
                                        </svg>
                                        Add Shareholder
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Step 5: Documents & Declaration -->
                        <div x-show="step === 5" data-step="5">
                            <div class="mb-8">
                                <h2 class="text-xl font-semibold text-gray-900">E. Documents & Declaration</h2>
                                <p class="mt-1 text-sm text-gray-500">Upload required documents and complete the
                                    declaration.</p>
                            </div>

                            <div class="grid grid-cols-1 gap-y-6 gap-x-4">
                                <!-- Required Documents -->
                                <div class="col-span-1">
                                    <h3 class="text-lg font-medium text-gray-900">Required Documents</h3>
                                    <p class="mt-1 text-sm text-gray-500">Please upload all required documents in PDF
                                        format</p>

                                    <div class="mt-4 space-y-6">
                                        <!-- Certificate of Incorporation -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 required">
                                                Certificate of Incorporation
                                            </label>
                                            <div class="mt-1 flex items-center">
                                                <input type="file" name="documents[0].file" accept="application/pdf"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    required>
                                                <input type="hidden" name="documents[0].type"
                                                    value="incorporation_cert">
                                            </div>
                                        </div>

                                        <!-- Constitution Documents -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 required">
                                                Constitution Documents
                                            </label>
                                            <div class="mt-1 flex items-center">
                                                <input type="file" name="documents.constitution"
                                                    accept="application/pdf"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    required>
                                            </div>
                                        </div>

                                        <!-- Audited Financial Statements -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 required">
                                                Audited Financial Statements
                                            </label>
                                            <div class="mt-1 flex items-center">
                                                <input type="file" name="documents.financial_statements"
                                                    accept="application/pdf"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    required>
                                            </div>
                                        </div>

                                        <!-- Product Summary Note -->
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 required">
                                                Product Summary Note
                                            </label>
                                            <div class="mt-1 flex items-center">
                                                <input type="file" name="documents.product_summary"
                                                    accept="application/pdf"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    required>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Declaration -->
                                <div class="col-span-1 mt-6">
                                    <h3 class="text-lg font-medium text-gray-900">Declaration</h3>
                                    <div class="mt-4">
                                        <div class="relative flex items-start">
                                            <div class="flex items-center h-5">
                                                <input type="checkbox" name="declaration.terms_accepted"
                                                    class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"
                                                    required>
                                            </div>
                                            <div class="ml-3 text-sm">
                                                <label class="font-medium text-gray-700">
                                                    I/We declare that:
                                                </label>
                                                <p class="text-gray-500">
                                                    All conditions for admission to trading under the Rules have been
                                                    fulfilled, and all required documents and information have been or
                                                    will be supplied. I/We will comply with all provisions of the Rules
                                                    that apply to issuers having their Securities admitted to trading on
                                                    Finstreet Global Markets Ltd.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Signatory Details -->
                                    <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2">
                                        <div class="sm:col-span-1">
                                            <label class="block text-sm font-medium text-gray-700 required">
                                                Name of Authorized Signatory
                                            </label>
                                            <div class="mt-1">
                                                <input type="text" name="declaration.signatory.name"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    required>
                                            </div>
                                        </div>

                                        <div class="sm:col-span-1">
                                            <label class="block text-sm font-medium text-gray-700 required">
                                                Position/Role
                                            </label>
                                            <div class="mt-1">
                                                <input type="text" name="declaration.signatory.role"
                                                    class="form-input block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
                                                    required>
                                            </div>
                                        </div>

                                        <div class="sm:col-span-2">
                                            <label class="block text-sm font-medium text-gray-700 required">
                                                Digital Signature
                                            </label>
                                            <div class="mt-1">
                                                <div id="signature-pad" class="border border-gray-300 rounded-md p-4">
                                                    <!-- Signature pad will be initialized here via JavaScript -->
                                                    <canvas class="w-full h-40 border border-gray-200"></canvas>
                                                </div>
                                                <input type="hidden" name="declaration.signature" id="signature-data">
                                                <button type="button"
                                                    class="mt-2 text-sm text-indigo-600 hover:text-indigo-500"
                                                    onclick="clearSignature()">
                                                    Clear Signature
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize signaturePad globally
        let signaturePad;

        function initSignaturePad() {
            const canvas = document.querySelector("#signature-pad canvas");
            signaturePad = new SignaturePad(canvas);

            // Handle window resize
            function resizeCanvas() {
                const ratio = Math.max(window.devicePixelRatio || 1, 1);
                canvas.width = canvas.offsetWidth * ratio;
                canvas.height = canvas.offsetHeight * ratio;
                canvas.getContext("2d").scale(ratio, ratio);
                signaturePad.clear();
            }

            window.onresize = resizeCanvas;
            resizeCanvas();

            // Clear signature function
            window.clearSignature = () => {
                signaturePad.clear();
            };
        }

        function formHandler() {
            return {
                step: 1,
                totalSteps: 5,
                handleNavigateToStep(event) {
                    this.step = event.detail.step;
                    this.$nextTick(() => {
                        event.detail.field.focus();
                        event.detail.field.reportValidity();
                    });
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            initSignaturePad();

            const form = document.querySelector("#admissionForm");
            form.addEventListener('submit', function (event) {
                event.preventDefault(); // Prevent default submission

                // Collect all required fields
                const requiredFields = this.querySelectorAll('[required]');
                let formIsValid = true;
                let firstInvalidField = null;

                requiredFields.forEach(function (field) {
                    if (!field.checkValidity()) {
                        formIsValid = false;
                        if (!firstInvalidField) {
                            firstInvalidField = field;
                        }
                        // Optionally, you can add custom validation messages here
                    }
                });

                if (!formIsValid) {
                    // Determine the step of the first invalid field
                    let fieldStep = null;
                    let parent = firstInvalidField.parentElement;
                    while (parent && !fieldStep) {
                        if (parent.hasAttribute('data-step')) {
                            fieldStep = parseInt(parent.getAttribute('data-step'), 10);
                            break;
                        }
                        parent = parent.parentElement;
                    }

                    if (fieldStep) {
                        // Access the Alpine.js component
                        const formComponentEl = document.querySelector('[x-ref="formComponent"]');
                        const formComponent = formComponentEl.__x;

                        // Set the step
                        formComponent.$data.step = fieldStep;

                        // Wait for the DOM to update
                        formComponent.$nextTick(() => {
                            // Now the invalid field should be visible
                            firstInvalidField.focus();

                            // Optionally, display the browser's validation message
                            firstInvalidField.reportValidity();
                        });
                    }
                } else {
                    // Form is valid, proceed with submission

                    // Handle signature pad
                    if (signaturePad.isEmpty()) {
                        alert("Please provide a signature");
                        return false;
                    }
                    document.querySelector("#signature-data").value = signaturePad.toDataURL();

                    // Submit the form
                    form.submit();
                }
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script defer src="https://unpkg.com/alpinejs@3.12.0/dist/cdn.min.js"></script>

</body>

</html>